{
	"size": 0,
	"query": {
		"bool": {
			"must": [
				{
					"term": {
						"user_id": "$$USERNAME"
					}
				}
			]
		}
	},
	"aggs": {
		"startDate": {
			"min": {
				"field": "timestamp"
			}
		},
		"lastActive": {
			"max": {
				"field": "timestamp"
			}
		},
		"attempts": {
			"filter": {
				"terms": {
					"event_type": [
						"RunnerEnd",
						"TransferenceStatsEnd"
					]
				}
			},
			"aggs": {
				"lastAttempt": {
					"max": {
						"field": "timestamp"
					}
				},
				"weeks": {
					"date_histogram": {
						"field": "timestamp",
						"interval": "week",
						"min_doc_count": 1
					}
				},
				"sessions": {
					"date_histogram": {
						"field": "timestamp",
						"interval": "12h",
						"min_doc_count": 1
					},
					"aggs": {
						"weeks": {
							"date_histogram": {
								"field": "timestamp",
								"interval": "week",
								"min_doc_count": 1
							}
						}
					}
				},
				"avgAttemptsPerWeek": {
					"avg_bucket": {
						"buckets_path": "weeks>_count"
					}
				}
			}
		},
		"missions": {
			"filter": {
				"terms": {
					"event_type": [
						"TransferenceStatsEnd"
					]
				}
			},
			"aggs": {
				"idCount": {
					"cardinality": {
						"field": "MissionID"
					}
				},
				"weeks": {
					"date_histogram": {
						"field": "timestamp",
						"interval": "week",
						"min_doc_count": 1
					}
				},
				"avgMissionsPerWeek": {
					"avg_bucket": {
						"buckets_path": "weeks>_count"
					}
				}
			}
		},
		"playtime": {
			"filter": {
				"exists": {
					"field": "MissionID"
				}
			},
			"aggs": {
				"total": {
					"sum": {
						"script": {
							"source": "doc['timestamp'].value.getMillis() - doc['timestamp'].value.getMillis()"
						}
					}
				}
			}
		}
	}
}