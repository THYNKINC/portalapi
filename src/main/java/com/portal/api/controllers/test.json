{
	"size": 0,
	"aggregations": {
		"range": {
			"filter": {
				"range": {
					"timestamp": {
						"from": "now-7d/d",
						"to": null,
						"include_lower": true,
						"include_upper": true,
						"boost": 1.0
					}
				}
			},
			"aggregations": {
				"daily": {
					"date_histogram": {
						"field": "timestamp",
						"interval": "1d",
						"offset": 0,
						"order": {
							"_key": "asc"
						},
						"keyed": false,
						"min_doc_count": 0
					},
					"aggregations": {
						"power": {
							"max": {
								"field": "Score"
							}
						},
						"attempts": {
							"filter": {
								"terms": {
									"event_type": [
										"RunnerEnd",
										"TransferenceStatsEnd"
									],
									"boost": 1.0
								}
							},
							"aggregations": {
								"sessions": {
									"date_histogram": {
										"field": "timestamp",
										"interval": "12h",
										"offset": 0,
										"order": {
											"_key": "asc"
										},
										"keyed": false,
										"min_doc_count": 0
									}
								}
							}
						},
						"starts": {
							"filter": {
								"terms": {
									"event_type": [
										"RunnerStart",
										"TransferenceStatsStart"
									],
									"boost": 1.0
								}
							}
						},
						"missions": {
							"filter": {
								"terms": {
									"event_type": [
										"TransferenceStatsEnd"
									],
									"boost": 1.0
								}
							}
						}
					}
				}
			}
		},
		"active": {
			"filter": {
				"exists": {
					"field": "MissionID",
					"boost": 1.0
				}
			},
			"aggregations": {
				"sessions": {
					"terms": {
						"field": "session_start.keyword",
						"size": 100000,
						"min_doc_count": 1,
						"shard_min_doc_count": 0,
						"show_term_doc_count_error": false,
						"order": [
							{
								"_count": "desc"
							},
							{
								"_key": "asc"
							}
						]
					},
					"aggregations": {
						"duration": {
							"max": {
								"script": {
									"source": "doc['timestamp'].value.getMillis() - doc['session_start'].value.getMillis()",
									"lang": "painless"
								}
							}
						}
					}
				},
				"users": {
					"cardinality": {
						"field": "user_id"
					}
				}
			}
		}
	}
}